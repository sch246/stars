/* --- Âü∫Á°ÄÊ†∑Âºè --- */
body { margin: 0; overflow: hidden; background-color: #050508; font-family: 'Segoe UI', sans-serif; color: #ddd; }
#canvas { display: block; width: calc(100vw - var(--sidebar-width, 340px)); height: 100vh; cursor: crosshair; outline: none; }

/* --- ‰æßËæπÊ†è --- */
#sidebar {
    position: fixed; right: 0; top: 0;
    width: var(--sidebar-width, 340px);
    height: 100vh;
    background: #111114; border-left: 1px solid #2a2a30;
    padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; z-index: 10;
    box-shadow: -5px 0 20px rgba(0,0,0,0.8);
}
#sidebar-resizer {
    position: fixed; right: var(--sidebar-width, 340px); top: 0; width: 8px; height: 100vh;
    background: #050508; cursor: ew-resize; z-index: 11; transition: background 0.2s;
}
#sidebar-resizer:hover { background: #4facfe; }
input, textarea { background: transparent; border: none; color: #eee; outline: none; width: 100%; display: block; font-family: 'Segoe UI', sans-serif; }
input::placeholder, textarea::placeholder { color: #444; font-style: italic; }

#node-label { font-size: 28px; font-weight: 700; margin-bottom: 8px; color: #4facfe; border-bottom: 2px solid #2a2a30; padding-bottom: 8px; }
#node-label:focus { border-bottom-color: #4facfe; }

#node-uuid { font-size: 10px; color: #444; font-family: monospace; margin-bottom: 5px; user-select: all;}
#link-status { font-size: 12px; font-family: monospace; margin-bottom: 15px; color: #666; font-weight: bold; display: flex; justify-content: space-between;}

#node-summary {
    font-size: 14px; color: #aaa; margin-bottom: 20px; line-height: 1.5;
    background: #0d0d0f; border: 1px solid transparent; border-radius: 4px; padding: 5px;
    height: 60px; resize: vertical;
}
#node-summary:focus { border-color: #333; background: #151518; }

#node-content {
    flex-grow: 1; background: #0a0a0c; border: 1px solid #222; padding: 15px;
    resize: none; font-family: 'Consolas', 'Courier New', monospace; line-height: 1.7;
    border-radius: 6px; font-size: 13px; color: #ccc;
}
#node-content:focus { border-color: #4facfe; }

#node-color-container { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
#node-color-input { width: 30px; height: 30px; background: transparent; border: none; cursor: pointer; padding: 0; }
#node-color-hex { flex-grow: 1; background: #0a0a0c; border: 1px solid #222; padding: 8px 10px; border-radius: 6px; font-size: 13px; color: #ccc; text-transform: uppercase; }

/* --- HUD & Slots --- */
#hud { position: fixed; top: 20px; left: 25px; pointer-events: none; z-index: 5; opacity: 0.9; display: flex; flex-direction: column; gap: 20px;}
h1 { margin: 0; font-size: 18px; color: #555; letter-spacing: 2px; text-transform: uppercase; }
.controls { font-size: 12px; color: #444; line-height: 1.6; font-family: monospace; }
.key { color: #4facfe; font-weight: bold; background: rgba(79, 172, 254, 0.1); padding: 2px 4px; border-radius: 3px;}

#slot-bar { display: flex; gap: 15px; pointer-events: auto; margin-top: 5px;}
.slot { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; opacity: 0.6; transition: 0.3s; width: 60px; }
.slot:hover { opacity: 1; transform: scale(1.1); }
.slot.active { opacity: 1; }
.slot-circle {
    width: 24px; height: 24px; border-radius: 50%; background: #333; border: 2px solid transparent;
    box-shadow: 0 0 5px rgba(0,0,0,0.5); transition: 0.3s; position: relative;
}
.slot-num {
    position: absolute; top: -5px; left: -5px; font-size: 10px; font-weight: bold; color: #666; background: #050508; padding: 1px 3px; border-radius: 4px;
}
.slot.active .slot-num { color: #4facfe; }
.slot-name { font-size: 11px; color: #888; text-align: center; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.slot.active .slot-name { color: #ddd; font-weight: bold; }

#view-controls { font-family: monospace; color: #666; font-size: 12px; }
#layer-indicator { color: #4facfe; font-weight: bold; }

/* --- ËøûÁ∫øÊ®°ÂºèÊåáÁ§∫Âô® --- */
#link-mode-indicator {
    display: none; font-size: 14px; font-weight: bold; color: #fff;
    background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.2); margin-top: 5px;
}
#link-mode-indicator.active { display: inline-block; animation: pulse-text 2s infinite; }
@keyframes pulse-text { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }

/* --- ËèúÂçïÈÄöÁî®Ê†∑Âºè --- */
.overlay-menu {
    position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateX(calc(-1 * var(--sidebar-width, 340px) / 2)); /* Ë∞ÉÊï¥‰ΩçÁΩÆ */
    background: #1a1a1d; border: 1px solid #444; padding: 15px; border-radius: 8px;
    display: none; flex-direction: column; gap: 6px; z-index: 50; box-shadow: 0 10px 30px rgba(0,0,0,1); min-width: 260px;
}
.overlay-menu.active { display: flex; }
.menu-title { font-size: 12px; color: #888; margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 5px;}
.menu-opt { font-size: 13px; color: #ccc; padding: 8px 10px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; transition: background 0.2s;}
.menu-opt:hover, .menu-opt.selected { background: #333; color: #fff; }
.menu-key { color: #4facfe; font-weight: bold; font-family: monospace; margin-right: 12px; min-width: 20px;}
.menu-del { color: #e74c3c; font-size: 11px; margin-left: auto; }
.menu-opt.delete-opt { color: #e74c3c; } /* ‰∏∫Âà†Èô§ÈÄâÈ°πÊ∑ªÂä†ÁâπÊÆäÈ¢úËâ≤ */


#tooltip { position: absolute; opacity: 0; background: rgba(0, 0, 0, 0.9); padding: 10px 14px; border-radius: 4px; border-left: 3px solid #4facfe; pointer-events: none; color: #ddd; font-size: 12px; transition: opacity 0.15s; z-index: 100; max-width: 280px; box-shadow: 0 4px 15px rgba(0,0,0,0.6);}
#tooltip.fixed-mode { top: 70%; left: 50%; transform: translate(-50%, 0) translateX(calc(-1 * var(--sidebar-width, 340px) / 2)); text-align: center; border-left: none; border-top: 3px solid #4facfe; }

/* --- ÂºπÁ™óÊèêÁ§∫ --- */
#flash-message {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) translateX(calc(-1 * var(--sidebar-width, 340px) / 2));
    padding: 15px 30px; border-radius: 8px; font-weight: bold; font-size: 14px;
    opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 404; box-shadow: 0 0 30px rgba(0,0,0,0.5);
    text-transform: uppercase; letter-spacing: 1px;
}
#flash-message.info { background: rgba(0, 123, 255, 0.15); color: #4facfe; border: 1px solid #4facfe; }
#flash-message.warn { background: rgba(255, 0, 0, 0.15); color: #ff4d4d; border: 1px solid #ff4d4d; }

#content-modal {
    display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.85); z-index: 300; justify-content: center; align-items: center;
}
#content-modal.active { display: flex; }
#modal-body {
    background: #161619; width: 800px; max-width: 90%; height: 85%; border: 1px solid #333; border-radius: 8px;
    padding: 40px; box-sizing: border-box; overflow-y: auto; color: #ccc;
    box-shadow: 0 0 50px rgba(0,0,0,1);
}
#modal-body h1, #modal-body h2, #modal-body h3 { color: #fff; border-bottom: 1px solid #333; padding-bottom: 5px; margin-top: 20px;}
#modal-body a { color: #4facfe; text-decoration: none; }
#modal-body code { background: #222; padding: 2px 5px; border-radius: 3px; font-family: monospace; color: #ff7675; }
#modal-body pre { background: #111; padding: 15px; border-radius: 5px; overflow-x: auto; }
#modal-body pre code { background: transparent; color: #ddd; padding: 0; }
#modal-body blockquote { border-left: 4px solid #444; margin: 0; padding-left: 15px; color: #888; }
#modal-body img { max-width: 100%; border-radius: 4px; }

/* ÂÖºÂÆπÊÄß classÔºåÂ¶ÇÊûúÈúÄË¶ÅÔºåÂèØ‰ª•Âú® JS ‰∏≠ÁªôËäÇÁÇπÂÜÖÂÆπ host Ê∑ªÂä† */
.node-content-host {
    line-height:1.8;
    font-size:16px;
    /* ÂÖ∂‰ªñËäÇÁÇπÂÜÖÂÆπÂå∫ÂüüÁöÑÈÄöÁî®Ê†∑Âºè */
}

#io-controls { position: fixed; bottom: 20px; left: 25px; z-index: 5; display: flex; gap: 10px; }
button { background: #1a1a1d; color: #777; border: 1px solid #333; padding: 6px 12px; cursor: pointer; font-size: 11px; border-radius: 3px; transition: 0.2s; }
button:hover { background: #333; color: #fff; border-color: #555; }

/* --- È¢ÑËÆæÁºñËæëÂô®Ê†∑Âºè --- */
#preset-editor {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: #161619; border: 1px solid #333; border-radius: 8px;
    padding: 20px; width: 500px; max-width: 90%; z-index: 400;
    display: none; flex-direction: column; gap: 10px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
}
#preset-editor.active { display: flex; }
.preset-list { max-height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
.preset-row { display: flex; gap: 10px; align-items: center; background: #0a0a0c; padding: 5px; border-radius: 4px; border: 1px solid #222; }
.preset-row:hover { border-color: #444; }
.preset-input { background: transparent; border: none; color: #ddd; font-family: monospace; font-size: 12px; padding: 4px; border-bottom: 1px solid transparent; }
.preset-input:focus { border-bottom-color: #4facfe; }
.preset-color { width: 25px; height: 25px; border: none; background: none; cursor: pointer; padding: 0; }
.preset-idx { color: #4facfe; font-weight: bold; font-family: monospace; width: 20px; text-align: center; user-select: none; }
.preset-del { color: #e74c3c; cursor: pointer; font-weight: bold; padding: 0 5px; user-select: none; }
.preset-del:hover { color: #ff6b6b; }
.preset-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; }
.btn-primary { background: #2980b9; color: white; border-color: #3498db; }
.btn-primary:hover { background: #3498db; }
/* Modal Body ÁâπÂÆö‰ª£Á†ÅÂùóÊ†∑Âºè */
#modal-body code {
    background: #282c34; 
    padding: 3px 6px;
    border-radius: 4px;
    font-family: 'Fira Code', 'JetBrains Mono', 'Consolas', monospace; 
    color: #abb2bf;
    font-size: 0.95em; 
}
#modal-body pre {
    background: #282c34;
    padding: 15px;
    border-radius: 6px;
    overflow-x: auto;
    margin-top: 1em;
    margin-bottom: 1em;
}
#modal-body pre code {
    background: none; 
    padding: 0;
    font-size: 1em; 
    color: #abb2bf;
    line-height: 1.5;
}

/* üî¥ Êñ∞Â¢ûÔºöËá™ÂÆö‰πâ Dialog Ê†∑Âºè */
#custom-dialog-overlay {
    display: none;
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7); z-index: 500;
    align-items: center; justify-content: center;
}
#custom-dialog-overlay.active { display: flex; }

#custom-dialog {
    background: #1a1a1d; border: 1px solid #444; border-radius: 8px;
    padding: 20px; width: 320px; box-shadow: 0 10px 40px rgba(0,0,0,0.9);
    display: flex; flex-direction: column; gap: 15px;
}
#custom-dialog-msg { font-size: 14px; color: #ddd; line-height: 1.5; text-align: center; }
#custom-dialog-input {
    background: #0a0a0c; border: 1px solid #333; padding: 8px;
    border-radius: 4px; width: 100%; box-sizing: border-box;
    color: #fff; display: none; /* ÈªòËÆ§ÈöêËóè */
}
#custom-dialog-input:focus { border-color: #4facfe; }
#custom-dialog-buttons { display: flex; justify-content: center; gap: 10px; } /* ÊåâÈíÆÂ±Ö‰∏≠ */
